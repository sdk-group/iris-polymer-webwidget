<script>
  window.IRIS = window.IRIS || {};

  var token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoid2Vid2lkZ2V0Iiwib3JpZ2luIjoidW5rbm93biIsImlhdCI6MTQ2NTk3OTYzMX0.epeiWjS5tPikygWatibnSobn43vj2s3718YyyTs-430";
  var server = "http://192.168.1.37:9000";

  var request = function(uri, data) {
    data = data || {};
    data.token = token;
    console.log(data);
    var url = server + uri;
    return fetch(url, {
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      method: 'POST',
      body: JSON.stringify(data)
    }).then(d => d.json()).then(d => {
      console.log(d);
      return d.value
    })
  }

  window.IRIS.webwidget = {
    getTerminals() {
      console.log('<IRIS> getTerminals');
      // return Promise.resolve([{
      //   label: "Терминал-1",
      //   id: "term-1"
      // }, {
      //   label: "Терминал-2",
      //   id: "term-2"
      // }, {
      //   label: "Терминал-3",
      //   id: "term-3"
      // }, {
      //   label: "Терминал-2",
      //   id: "term-2"
      // }, {
      //   label: "Терминал-3",
      //   id: "term-3"
      // }]).delay(1000);

      return request('/agent/info').then(d => {
        console.log(d);
        return d.ws_available
      })
    },
    getTerminalLayout(terminal_id) {
      console.log('<IRIS> getTerminalLayout', terminal_id);
      // return Promise.resolve({
      //   base: {
      //     root: {
      //       content: [{
      //         id: "service-1",
      //         label: "Услуга 1"
      //       }, {
      //         id: "service-2",
      //         label: "Услуга 2"
      //       }, {
      //         id: "service-3",
      //         label: "Услуга 3"
      //       }]
      //     }
      //   }
      // }).delay(1000);

      return request('/terminal/bootstrap', {
        workstation: terminal_id
      }).then(d => d.views)
    },
    getAvailableDays(ticket_query) {
      console.log('<IRIS> getAvailableDays', ticket_query);

      return request('/prebook/available-days', ticket_query)
    },
    getDaySlots(ticket_query) {
      console.log('<IRIS> getDaySlots', ticket_query);


      return request('/prebook/ticket-observe', ticket_query)
    },
    confirmTicket(ticket_query) {
      console.log('<IRIS> confirmTicket', ticket_query);
      return request('/prebook/ticket-confirm', ticket_query)
    }
  };
</script>

<script src="../lodash/dist/lodash.min.js"></script>
<script src="../moment/min/moment.min.js"></script>
<script src="../moment/locale/ru.js"></script>
<script src="../bluebird/js/browser/bluebird.min.js"></script>
