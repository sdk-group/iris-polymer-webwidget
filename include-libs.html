<script>
  //@NOTE: draft of irisCdn
  window.IRIS = window.IRIS || {};

  var request = function(uri, data) {
    return fetch(uri, {
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      method: 'POST',
      body: JSON.stringify(data)
    }).then(d => d.json())
  }

  window.IRIS.webwidget = {
    token: "1234567",
    getTerminals() {
      return Promise.resolve([{
        label: "Терминал-1",
        id: "term-1"
      }, {
        label: "Терминал-2",
        id: "term-2"
      }, {
        label: "Терминал-3",
        id: "term-3"
      }, {
        label: "Терминал-2",
        id: "term-2"
      }, {
        label: "Терминал-3",
        id: "term-3"
      }]).delay(1000);

      return request('/agen/info').then(d => d.available_ws)
    },
    getTerminalLayout(terminal_id) {
      return Promise.resolve({
        base: {
          root: {
            content: [{
              id: "service-1",
              label: "Услуга 1"
            }, {
              id: "service-2",
              label: "Услуга 2"
            }, {
              id: "service-3",
              label: "Услуга 3"
            }]
          }
        }
      }).delay(1000);

      return request('/terminal/bootstrap', {
        workstation: terminal_id
      }).then(d => d.views)
    },
    getAvailableDays(ticket_query) {
      return Promise.resolve({
        days: [{
          date: "2016-06-13T06:55:28+05:00",
          is_available: false
        }, {
          date: "2016-06-14T06:55:28+05:00",
          is_available: false
        }, {
          date: "2016-06-15T06:55:28+05:00",
          is_available: false
        }, {
          date: "2016-06-16T06:55:28+05:00",
          is_available: false
        }, {
          date: "2016-06-17T06:55:28+05:00",
          is_available: false
        }],
        done: false
      }).delay(500);

      return request('prebook/available-days', ticket_query)
    },
    getDaySlots(ticket_query) {
      let a = [];
      for (var i = 0; i < 100; i++) {
        a[i] = {
          time_description: [i * 1800, (i + 1) * 1800]
        };
      }
      return Promise.resolve({
        slots: a
      }).delay(500)

      return request('/prebook/ticket-observe', ticket_query)
    },
    confirmTicket(ticket_query) {
      return Promise.resolve({
        context: {},
        ticket: {
          id: "ticket-department-1-2016-06-14--2",
          code: "0012565262",
          time_description: [0, 900],
          dedicated_date: "2016-06-14"
        }
      });

      return request('/prebook/ticket-confirm', ticket_query)
    }
  };
</script>

<script src="../lodash/dist/lodash.min.js"></script>
<script src="../moment/min/moment.min.js"></script>
<script src="../moment/locale/ru.js"></script>
<script src="../bluebird/js/browser/bluebird.min.js"></script>